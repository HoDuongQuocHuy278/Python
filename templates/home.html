{% extends "base.html" %}
{% block title %}Trao đổi đồ cũ{% endblock %}

{% block extra_head %}
<style>
  /* Hero + các card */
  .hero-box{
    background: linear-gradient(135deg,#ffe3d9 0%, #ffffff 55%);
    border: 1px solid #eee; border-radius:16px; padding:24px;
    box-shadow: 0 10px 24px rgba(0,0,0,.06);
  }
  .side-card{
    background:#fff; border:1px solid #eee; border-radius:14px;
    padding:16px; box-shadow:0 6px 18px rgba(0,0,0,.05);
  }
  /* Danh mục */
  .cat-card{
    background:#fff; border:1px solid #eef0f3; border-radius:14px; padding:16px;
    text-align:center; text-decoration:none; color:#1f2937; height:100%;
    transition: transform .15s ease, box-shadow .15s ease;
    box-shadow:0 8px 22px rgba(2,12,27,.06);
  }
  .cat-card:hover{ transform: translateY(-2px); box-shadow:0 16px 30px rgba(2,12,27,.12); }
  .cat-ico{ font-size:32px; line-height:1; }
</style>
{% endblock %}

{% block content %}
<div class="container py-3">

  <!-- HERO: Banner + 2 thẻ cam kết -->
  <div class="row g-3 align-items-stretch">
    <div class="col-lg-9">
      <div class="hero-box h-100">
        <h3 class="fw-bold mb-2">“DỌN NHÀ” THÔNG MINH – RINH NGÀN ƯU ĐÃI</h3>
        <p class="text-muted mb-3">Hoàn 100% phí bán hàng · Giao dịch miễn phí · Nhiều voucher hấp dẫn</p>
        <a class="btn btn-success" href="{{ url_for('sell') if is_logged_in else url_for('login') }}">+ Đăng bán ngay</a>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="side-card mb-3">
        <div class="d-flex align-items-center gap-2">
          <span>✅</span>
          <div>
            <div class="fw-semibold">Nhận sản phẩm như mô tả</div>
            <div class="text-muted small">Hoặc nhận tiền hoàn</div>
          </div>
        </div>
      </div>
      <div class="side-card">
        <div class="d-flex align-items-center gap-2">
          <span>📱</span>
          <div>
            <div class="fw-semibold">Mua bán thuận tiện</div>
            <div class="text-muted small">Quét QR để tải app</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DANH MỤC -->
  <div class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="m-0">Danh mục nổi bật</h4>
      <a href="#" class="text-decoration-none">Xem tất cả</a>
    </div>

    <div class="row g-3">
      {% set cats = [
        ('📚','Sách'), ('👗','Thời trang nữ'), ('👕','Thời trang nam'), ('🍼','Mẹ & Bé'),
        ('🧸','Đồ chơi'), ('🚗','Xe cộ'), ('🏠','Đồ gia dụng'), ('👟','Giày dép'),
        ('💻','Đồ điện tử'), ('🐶','Thú cưng')
      ] %}
      {% for icon, name in cats %}
      <div class="col-6 col-md-4 col-lg-2">
        <a class="cat-card d-block text-reset" href="#">
          <div class="cat-ico">{{ icon }}</div>
          <div class="fw-semibold mt-1">{{ name }}</div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>

</div>
<!-- CHATBOT FLOATING -->
<!-- Nút mở chat -->
<div id="chat-toggle" 
     style="position:fixed; bottom:20px; right:20px; background:#28a745; color:#fff; border-radius:50%; width:50px; height:50px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2); z-index:1000;">
💬
</div>

<!-- Khung chatbot -->
<div id="chat-widget" 
     style="display:none; position:fixed; bottom:80px; right:20px; width:320px; height:400px; border:1px solid #ccc; border-radius:10px; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,0.3); z-index:1000; overflow:hidden;">

  <div style="background:#28a745; color:#fff; padding:10px; font-weight:bold;">Chatbot</div>
  <div id="chatbox" style="height:300px; overflow-y:auto; padding:10px; font-size:14px;"></div>

  <div style="display:flex; border-top:1px solid #ddd;">
    <input id="msg" type="text" placeholder="Nhập tin nhắn..." style="flex:1; border:none; padding:10px;">
    <button onclick="sendMessage()" style="background:#28a745; color:#fff; border:none; padding:10px 15px; cursor:pointer;">Gửi</button>
  </div>
</div>

<script>
document.getElementById("chat-toggle").onclick = function() {
  let box = document.getElementById("chat-widget");
  box.style.display = (box.style.display === "none") ? "block" : "none";
};

async function sendMessage() {
  let userMsg = document.getElementById("msg").value;
  let chatbox = document.getElementById("chatbox");

  if (!userMsg) return;

  chatbox.innerHTML += "<p><b>Bạn:</b> " + userMsg + "</p>";
  document.getElementById("msg").value = "";

  let res = await fetch("/chatbot", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: userMsg })
  });

  let data = await res.json();
  if (data.reply) {
    chatbox.innerHTML += "<p><b>Bot:</b> " + data.reply + "</p>";
  } else {
    chatbox.innerHTML += "<p><b>Bot (lỗi):</b> " + data.error + "</p>";
  }

  chatbox.scrollTop = chatbox.scrollHeight;
}
</script>




{% endblock %}
